<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		

		<link rel="stylesheet" type="text/css" href="../static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="../lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/style.css" />
		<link rel="stylesheet" href="../css/bootstrap.min.css" />
		<link rel="stylesheet" href="../css/layui.css" media="all" />
		<link rel="srstylesheet" href="../css/layui.mobile.css" />
		<link rel="stylesheet" href="../js/laydate/theme/default/laydate.css" />
		<title>事项信息</title>
	</head>
	<body>
		<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 事项信息 <span class="c-gray en">&gt;</span>
			事项信息列表 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px;position: absolute;left: 90%;" href="javascript:location.replace(location.href);"
			 title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a></nav>
		<div class="page-container">

			<div class="text-c">
				<form>
					<table class="table  table-bg">
						<thead>

							<tr class="text-c">

								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">事项<br />来源</label>
										<div class="formControls col-xs-8 col-sm-7">
											<span class="select-box">
												<select name="sourceId" class="select" id="sourceId">
													<option value="-1">---请选择---</option>
												</select>
											</span>
										</div>
									</div>
								</th>
								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">事项<br />编号</label>
										<div class="formControls col-xs-8 col-sm-7">
											<input type="text" class="input-text" value="" placeholder="" id="username" name="username" />
										</div>
									</div>
								</th>
								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">事项<br />名称</label>
										<div class="formControls col-xs-8 col-sm-7">
											<input type="text" class="input-text" value="" placeholder="" id="username" name="username" />
										</div>
									</div>
								</th>

								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">事项<br />内容</label>
										<div class="formControls col-xs-8 col-sm-7">
											<input type="text" class="input-text" value="" placeholder="" id="username" name="username" />
										</div>
									</div>
								</th>
								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">是否任务超时</label>
										<div class="formControls col-xs-8 col-sm-7">
											<span class="select-box">
												<select name="" class="select">
													<option value="1">未删除</option>
													<option value="2">已删除</option>
												</select>
											</span>
										</div>
									</div>
								</th>

							</tr>

							<tr class="text-c">
								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">当前<br />状态</label>
										<div class="formControls col-xs-8 col-sm-7">
											<span class="select-box" style="width: 80px;">
												<select name="" class="select">
													<option value="1">未删除</option>
													<option value="2">已删除</option>
												</select>
											</span>
										</div>
									</div>
								</th>
								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">公司<br />领导</label>
										<div class="formControls col-xs-8 col-sm-7">
											<span class="select-box">
												<select name="user" class="select" id="userId">
													<option value="-1">---请选择---</option>
												</select>
											</span>
										</div>
									</div>
								</th>
								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">牵头<br />部门</label>
										<div class="formControls col-xs-8 col-sm-7">
											<span class="select-box">
												<select name="orgId" class="select" id="orgId">
													<option value="-1">---请选择---</option>
												</select>
                                			</span>
										</div>
									</div>
								</th>

								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">是否<br />延期</label>
										<div class="formControls col-xs-8 col-sm-7">
											<span class="select-box">
												<select name="" class="select">
													<option value="1">未删除</option>
													<option value="2">已删除</option>
												</select>
											</span>
										</div>
									</div>
								</th>
								<th>
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-5">是否<br />已订阅</label>
										<div class="formControls col-xs-8 col-sm-7">
											<span class="select-box">
												<select name="" class="select">
													<option value="1">未删除</option>
													<option value="2">已删除</option>
												</select>
											</span>
										</div>
									</div>
								</th>
							</tr>
							<tr>
								<th scope="col" colspan="2">
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-3">修改时间:</label>
										<div class="formControls col-xs-8 col-sm-9">
											<input type="text" class="layui-input" id="optTime" placeholder=" - ">

										</div>
									</div>
								</th>
								<th scope="col" colspan="2">
									<div class="row cl">
										<label class="form-label col-xs-4 col-sm-3">修改时间:</label>
										<div class="formControls col-xs-8 col-sm-9">
											<input type="text" class="layui-input" id="test10" placeholder=" - ">

										</div>
									</div>

								</th>
								<th>
									<div class="row cl">

										<div class="col-xs-9 col-sm-9 col-xs-offset-4 col-sm-offset-1">
											<input class="btn btn-primary radius" type="submit" value="检索" />
											<input class="btn btn-primary radius" type="submit" value="重置" />
										</div>
									</div>
								</th>
							</tr>
						</thead>
					</table>
				</form>
			</div>
			<div class="cl pd-5 bg-1 bk-gray mt-20">
				<span class="l">
					<a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont"></i> 导出XLS</a>
					<a href="javascript:;" onclick="admin_add('合并','entering-item.html','1000','500')" class="btn btn-primary radius"><i
						 class="Hui-iconfont">&#xe600;</i>合并</a>
					<a href="javascript:;" onclick="admin_add('取消合并','entering-item.html','1000','500')" class="btn btn-primary radius"><i
						 class="Hui-iconfont">&#xe600;</i>取消合并</a>

				</span>
			</div>
			<table id="table1" class="table table-border table-bordered table-bg">

			</table>
		</div>
		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="../static/h-ui/js/H-ui.min.js"></script>
		<script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script>
		<!--/_footer 作为公共模版分离出去-->

		<!--请在下方写此页面业务相关的脚本-->
		<script src="../js/laydate/laydate.js"></script>
		<script src="../js/layui.js"></script>
		<script type="text/javascript" src="../lib/My97DatePicker/4.8/WdatePicker.js"></script>
		<script type="text/javascript" src="../lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="../lib/laypage/1.2/laypage.js"></script>
		<script type="text/javascript" src="../js/common.js"></script>
		<script>
			$(function() {
				loadData();
				orgInit();
                sourceInit();
                leaderInit();
                lay('#version').html('-v'+ laydate.v);
                //日期时间范围
                laydate.render({
                    elem: '#optTime'
                    ,type: 'datetime'
                    ,range: true
                });
                lay('#version').html('-v'+ laydate.v);
                //日期时间范围
                laydate.render({
                    elem: '#test10'
                    ,type: 'datetime'
                    ,range: true
                });
			});
			/*添加*/
			function admin_add(title, url, w, h) {
				layer_show(title, url, w, h);
			}
		
			 function recharge_cards(title, url, w, h) {
				layer_show(title, url, w, h);
			} 
		
			var dutytest = JSON.parse(window.localStorage.getItem("user"));
			var test=dutytest.duty.dutyId;
			
			
			function loadData() {
		
				layui.use('table', function() {
					var table = layui.table;
					table.render({
						elem: "#table1",
						height: 475,
						limit: 10,
						/* cellMinWidth: 80, */
						url: 'http://localhost:8888/Supervise/queryFirstpage', //数据接口
						page: true, //开启分页
						cols: [
							[{
									
									title: '事项名称',								
									
									fixed: 'left',
									align: 'center',
									toolbar: '#barDemod'
								},
								{
									templet: '<div>{{d.user.realName}}</div>',
									title: '公司领导',
									align: 'center',
									
									
								},
								
								{
									templet: '<div>{{d.orgId.orgName}}</div>',
									title: '牵头部门',
									align: 'center',
									
									
								},
								{
									templet: '<div>{{d.itemCode.userId.realName}}</div>',
									title: '负责人',
									align: 'center',
									
									
								},
								{
									templet: '<div>{{d.overTime}}</div>',
									title: '应办时间',
									align: 'center',
									width: 200,
									
								},
								{
									templet: '<div>{{d.itemCode.optTime}}</div>',
									title: '最后修改时间',
									align: 'center',
									width: 200,
									
								},
								
								{
									fixed: 'right',
									title: '操作',
									align: 'center',
									width: 180,
									
									toolbar: '#barDemo'
								},
		
							]
						],
						parseData: function(res) { //将原始数据解析成 table 组件所规定的数据
							return {
								"code": res.code, //解析接口状态
								"count": res.count, //解析数据长度
								"data": res.data //解析数据列表
							};
						}
		
					});
		
				});
				xhrFields: {
					withCredentials: true
				}
			}
			
			
			
		</script>
		<script type="text/html" id="barDemod">
			
			{{# if(test==6){ }}
			<a href="basic_info/sur_info.html?cid={{d.id}}"  ><span class="glyphicon glyphicon-yen"></span>{{d.itemName}}</a> {{# } else if(test==3||test==4){ }}
			<a href="dept_info/dept_info.html?cid={{d.id}}"  ><span class="glyphicon glyphicon-yen"></span>{{d.itemName}}</a> {{# } else if(test==5){ }}
			<a href="emp_info/emp_info.html?cid={{d.id}}"  ><span class="glyphicon glyphicon-yen"></span>{{d.itemName}}</a>{{# } else if(test==1||test==2){ }}
			<a href="lead_info/lead_info.html?cid={{d.id}}"  ><span class="glyphicon glyphicon-yen"></span>{{d.itemName}}</a>{{# } }}
			
		</script>
		<script type="text/html" id="barDemo">
			<a style="text-decoration:none" onClick="admin_start(this,'10001')" href="javascript:;" title="启用"><i class="Hui-iconfont">&#xe615;</i></a> 
			<a title="编辑" href="javascript:;" onclick="admin_edit('修改事项','update-item.html','2','1000','500')" class="ml-5"
			 style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a>
			<a title="删除" href="javascript:;" onclick="admin_del(this,'1')" class="ml-5" style="text-decoration:none"><i
				 class="Hui-iconfont">&#xe6e2;</i></a>
		</script>

		<script type="text/javascript">
			/*初始化部门下拉列表*/
            function orgInit() {
                $.ajax({
                    url: HOST_URL + 'org',
                    type: 'GET',
                    contentType: '',
                    success: function (data) {
                        var leader = '';
                        if (!(data == '0')) {
                            $.each(data, function (i, user) {
                                leader += '<option value=' + user.orgId + '>' + user.orgName + '</option>';
                            });
                            $('#orgId').append(leader);
                        } else {
                            leader = '暂无部门';
                            $('#orgId').append(leader);
                        }
                    },
                    xhrFields: {
                        withCredentials: true
                    }
                }, 'JSON');
            }
            /**
             * 初始化事项来源
             */
            function sourceInit() {
                $.ajax({
                    url: HOST_URL + 'showSource',
                    type: 'GET',
                    success: function (data) {
                        var itemSource = '';
                        if (!(data == 'no_source')) {
                            $.each(data, function (i, source) {
                                itemSource += '<option value=' + source.sourceId + '>' + source.sourceType + '</option>';
                            });
                            $('#sourceId').append(itemSource);
                        } else {
                            itemSource = '暂无来源';
                            $('#sourceId').append(itemSource);
                        }
                    },
                    error: function (xhr, type, errorThrown) {
                        layer.alert('系统出现错误，请联系管理员');
                    },
                    xhrFields: {
                        withCredentials: true
                    },
                }, 'JSON');
            }

            /*初始化批示领导*/
            function leaderInit() {
                $.ajax({
                    url: HOST_URL + 'showLeader',
                    type: 'GET',
                    contentType: '',
                    success: function (data) {
                        var leader = '';
                        if (!(data == 'no_leader')) {
                            $.each(data, function (i, user) {
                                leader += '<option value=' + user.userId + '>' + user.realName + "(" + user.duty.dutyName + ")" + '</option>';
                            });
                            $('#userId').append(leader);
                        } else {
                            leader = '暂无领导';
                            $('#userId').append(leader);
                        }
                    },
                    error: function (xhr, type, errorThrown) {
                        layer.alert('系统出现错误，请联系管理员');
                    },
                    xhrFields: {
                        withCredentials: true
                    }
                }, 'JSON');
            }
			/*删除*/
			function emp_del(uid) {
				layer.confirm("确认要删除员工编号为：" + uid + " 的这条数据吗?", function(index) {
					$.ajax({
						url: 'http://localhost:8888/Supervise/user/deleteuser/' + uid,
						method: 'delete',
						success: function(data) {
		
							if (data == 'ok') {
								layer.msg(
									'删除成功', {
										icon: 1,
										time: 1000 //2秒关闭（如果不配置，默认是3秒）
									}
								);
								// 刷新窗口
								setTimeout('window.location.reload()', 1000); //指定1秒刷新一次
		
							} else {
								layer.msg(
									'没有删除数据', {
										icon: 1,
										time: 2000 //2秒关闭（如果不配置，默认是3秒）
									}
								);
							}
		
		
						},
						error: function(qXHR, textStatus, errorThrown) {
							layer.alert("系统出现错误，请联系管理员");
						}
					}, 'text');
		
					layer.close(index);
				});
			}
		</script>
		<script type="text/javascript">
			/*
	参数解释：
	title	标题
	url		请求的url
	id		需要操作的数据id
	w		弹出层宽度（缺省调默认值）
	h		弹出层高度（缺省调默认值）
*/
			/*管理员-增加*/
			function admin_add(title, url, w, h) {
				layer_show(title, url, w, h);
			}
			/*管理员-删除*/
			function admin_del(obj, id) {
				layer.confirm('确认要取消订阅吗？', function(index) {
					$.ajax({
						type: 'POST',
						url: '',
						dataType: 'json',
						success: function(data) {
							$(obj).parents("tr").remove();
							layer.msg('已取消订阅!', {
								icon: 1,
								time: 1000
							});
						},
						error: function(data) {
							console.log(data.msg);
						},
					});
				});
			}

			/*管理员-编辑*/
			function admin_edit(title, url, id, w, h) {
				layer_show(title, url, w, h);
			}
			/*管理员-停用*/
			function admin_stop(obj, id) {
				layer.confirm('确认要删除吗？', function(index) {
					//此处请求后台程序，下方是成功后的前台处理……

					$(obj).parents("tr").find(".td-manage").prepend(
						'<a onClick="admin_start(this,id)" href="javascript:;" title="恢复" style="text-decoration:none"><i class="Hui-iconfont">&#xe615;</i></a>'
					);
					$(obj).parents("tr").find(".td-status").html('<span class="label label-default radius">已删除</span>');
					$(obj).remove();
					layer.msg('已删除!', {
						icon: 5,
						time: 1000
					});
				});
			}

			/*管理员-启用*/
			function admin_start(obj, id) {
				layer.confirm('确认要恢复吗？', function(index) {
					//此处请求后台程序，下方是成功后的前台处理……


					$(obj).parents("tr").find(".td-manage").prepend(
						'<a onClick="admin_stop(this,id)" href="javascript:;" title="停用" style="text-decoration:none"><i class="Hui-iconfont">&#xe631;</i></a>'
					);
					$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已恢复</span>');
					$(obj).remove();
					layer.msg('已恢复!', {
						icon: 6,
						time: 1000
					});
				});
			}
		</script>
	</body>
</html>

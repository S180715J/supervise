<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../../static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="../../lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="../../static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>添加部门</title>
<link href="lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div class="page-container">
	<form class="form form-horizontal" id="form-article-add">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>机构编码：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="orgId" name="orgId">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">机构名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="orgName" name="orgName">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>选择父机构：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
				<select name="farpath" class="select" id="parentOrgid">
					<option value="-1">---请选择---</option>
				</select>
				</span>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">机构ID路径：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="机构ID路径" id="idPath" name="idPath" readonly="readonly">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">机构名称路径：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="机构名称路径" id="namePath" name="namePath" readonly="readonly">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">机构简介：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="简介" id="introduction" name="introduction">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">机构职责：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea name="responsibility" id="responsibility" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="$.Huitextarealength(this,200)"></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button id="save" onClick="article_save_submit();" class="btn btn-primary radius" type="button"><i class="Hui-iconfont">&#xe632;</i> 保存并提交审核</button>
				<button id="cancel" onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>
		</div>
	</form>
</div>


<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="../../lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="../../lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="../../static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="../../static/h-ui.admin/js/H-ui.admin.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="../../lib/jquery.validation/1.14.0/jquery.validate.js"></script> 
<script type="text/javascript" src="../../lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="../../lib/jquery.validation/1.14.0/messages_zh.js"></script> 
<script type="text/javascript" src="../../lib/webuploader/0.1.5/webuploader.min.js"></script>
<script src="../../js/jquery.serializejson.min.js"></script>
<script src="../../js/common.js"></script>
<script src="../../layui/layui.js"></script>
<script type="text/javascript">
function article_save(){
	window.parent.location.reload();
}

	$(function(){
        parentPathInit();
		add_path();
		$('#save').on('click', function() {
			save_dept();
			window.location.href="dept-list.html";
		});
		$('#cancel').on('click', function() {
			// 刷新父窗口
			window.parent.location.reload();
		});
	});


	/*对机构ID路径和机构名称路径进行赋值*/
	function add_path(){
		var orgId=$("#orgId").val();
		var orgName=$("#orgName").val();
		var parentIdPath=$("#parentOrgid option:selected").val();//获得value值
		var parentNamePath=$("#parentOrgid option:selected").text();//获得文本值
		if(orgId != ""){
			var idPath="/"+parentIdPath+"/"+orgId;//得到机构ID路径
			$('#idPath').val(idPath);
		}
		if(orgName != ""){
			var nameNath="/"+parentNamePath+"/"+orgName;//得到机构名称路径
			$('#namePath').val(nameNath);
		}
	}
	/*
	* 从数据库得到父路径并将值赋给下拉框
	*/
	function parentPathInit(){
		var parent = "";
		$.get(
			HOST_URL + "org",
			function(data){
				$.each(data, function (i, org) {
					parent += "<option value=" + org.orgId + ">" + org.orgName + "</option>";
				})
				$("#parentOrgid").append(parent);
			}
		);
	}
	/*
	*保存部门信息
	*/
	function save_dept(){
		var formData = $('#form-article-add').serializeJSON();
		var p = JSON.stringify(formData);
		console.info("发送数据：" + p);
		$.ajax({
			url:HOST_URL + 'insertorg',
			method: 'POST',
			data: p,
			contentType: "application/json;charset=utf-8",
			success : function(data){

			},
			error: function(jqXHR, textStatus, errorThrown) {
				layer.alert("系统出现错误,请联系管理员!");
			},
			xhrFields: {
				withCredentials: true
			}
		},'JSON');
	}
</script>
</body>
</html>
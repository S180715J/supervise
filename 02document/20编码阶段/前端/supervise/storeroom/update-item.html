<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" href="/favicon.ico">
	<link rel="Shortcut Icon" href="/favicon.ico" />
	<link rel="stylesheet" type="text/css" href="../static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/H-ui.admin.css" />
	<link rel="stylesheet" type="text/css" href="../lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/style.css" />
	<title>备用库管理-修改事项</title>
</head>

<body>
	<article class="page-container">
		<form action="" method="post" class="form form-horizontal" id="form-member-add">

			<form>
				<table class="table   table-bg">
					<thead>

						<tr class="text-c">
							<th>
								<div class="row cl">
									<label class="form-label col-xs-4 col-sm-6"><span class="c-red">*</span>事项名称：</label>
									<div class="formControls col-xs-8 col-sm-4">
										<input type="text" class="input-text" value="" placeholder="" id="itemName" name="itemName">
										</div>
									</div>
							</th>
							<th>
								<div class="row cl">
									<label class="form-label col-xs-4 col-sm-3">事项编号：</label>
									<div class="formControls col-xs-8 col-sm-4">
										<input type="text" class="input-text" value="" placeholder="" id="itemCode" name="itemCode">
										</div>
									</div>
							</th>
						</tr>
						<tr class="text-c">
							<th>
								<div class="row cl">
									<label class="form-label col-xs-4 col-sm-6"><span class="c-red">*</span>公司领导：</label>
									<div class="formControls col-xs-8 col-sm-4">
										<span class="select-box">
	                                <select name="user" class="select" id="userId">
	                                    <option value="-1">---请选择---</option>
	                                </select>
	                            </span>
									</div>
								</div>
							</th>
							<th>

							</th>
						</tr>


						<tr>
							<th scope="col" colspan="2">
								<div class="row cl">
									<label class="form-label col-xs-4 col-sm-3">备注：</label>
									<div class="formControls col-xs-8 col-sm-7">
										<textarea name="remark" cols="" rows="" id="remark" class="textarea" placeholder="说点什么...最少输入10个字符" datatype="*10-100"
											 dragonfly="true" nullmsg="备注"></textarea>
										<!--onKeyUp="$.Huitextarealength(this,200)"文本域方法-->
										<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
									</div>
								</div>
							</th>
						</tr>

						<tr class="text-c">
							<th scope="col" colspan="2">
								<div class="row cl">
									<label class="form-label col-xs-4 col-sm-3">附件：</label>
									<div class="formControls col-xs-9 col-sm-2">
										<span>附件1</span>&nbsp;&nbsp;<a href=""><label >XXX</label></a><br />
										<span>附件2</span>&nbsp;&nbsp;<a href=""><label >XXX</label></a>
									</div>
								</div>
							</th>
						</tr>

						<tr>
							<th scope="col" colspan="2">
								<div class="row cl">
									<label class="form-label col-xs-4 col-sm-3"></label>
									<div class="formControls col-xs-8 col-sm-9">
										<span class="btn-upload form-group">
												<input class="input-text upload-url" type="text" name="uploadfile" id="uploadfile" readonly nullmsg="请添加附件！"
												 style="width:200px">
												<a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i>
													浏览文件</a>
												<input type="file" multiple name="file-2" class="input-file">

											</span>
										<input class="btn btn-primary radius" type="button" value="&nbsp;&nbsp;上传&nbsp;&nbsp;">
										</div>
									</div>
							</th>
						</tr>


						<tr>
							<th scope="col" colspan="2" style="height: 60px;"></th>

						</tr>
						<tr>
							<th>
								<div class="row cl">
									<div class="col-xs-9 col-sm-9 col-xs-offset-4 col-sm-offset-4">
										<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;下载&nbsp;&nbsp;">
										</div>
									</div>
							</th>
							<th>
								<div class="row cl">
									<div class="col-xs-9 col-sm-9 col-xs-offset-4 col-sm-offset-4">
										<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;关闭&nbsp;&nbsp;">
										</div>
									</div>
							</th>
						</tr>
					</thead>
				</table>
				<!--隐藏域-->
				<input type="hidden" name="oldCode" value="" id="oldCode">
			</form>
	</article>

	<!--_footer 作为公共模版分离出去-->
	<script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="../static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script>
	<!--/_footer 作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="../lib/My97DatePicker/4.8/WdatePicker.js"></script>
	<script type="text/javascript" src="../lib/jquery.validation/1.14.0/jquery.validate.js"></script>
	<script type="text/javascript" src="../lib/jquery.validation/1.14.0/validate-methods.js"></script>
	<script type="text/javascript" src="../lib/jquery.validation/1.14.0/messages_zh.js"></script>
	<script type="text/javascript" src="../js/jquery.serializejson.min.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
	<script type="text/javascript">
		$(function() {
			$('.skin-minimal input').iCheck({
				checkboxClass: 'icheckbox-blue',
				radioClass: 'iradio-blue',
				increaseArea: '20%'
			});

			$("#form-member-add").validate({
				rules: {
					username: {
						required: true,
						minlength: 2,
						maxlength: 16
					},
					sex: {
						required: true,
					},
					mobile: {
						required: true,
						isMobile: true,
					},
					email: {
						required: true,
						email: true,
					},
					uploadfile: {
						required: true,
					},

				},
				onkeyup: false,
				focusCleanup: true,
				success: "valid",
				submitHandler: function(form) {
					//$(form).ajaxSubmit();
					var index = parent.layer.getFrameIndex(window.name);
					//parent.$('.btn-refresh').click();
					parent.layer.close(index);
				}
			});
		});
	</script>
	<script type="text/javascript">
		$(function() {
			//适用与一个参数
			function parseUrl(url) {
                if (url.indexOf("?") == -1) {
                    return {};
                }
                var value = url.split("=")[1];
                return value;
            }
			// url传递的信息
			var $urlMsg = parseUrl(window.location.search);
			$.ajax({
				url: HOST_URL + "item/one/" + $urlMsg,
				type: "GET",
				dataType: "json",
				success: function(data) {
					$("#itemName").val(data.itemName);
					//回显事项编号
					$("#itemCode").val(data.itemCode.itemCode);
					//给隐藏域赋旧编号
					$("#oldCode").val(data.itemCode.itemCode);
					$("select option:eq(" + data.user.duty.dutyId + ")").attr("selected", "selected");
					$("#remark").val(data.remark);
				},
				xhrFields: {
					withCredentials: true
				}
			});
			//提交
			$("input[type=submit]:eq(0)").click(function() {
				//表单以json形式提交
				var $dataFrom = $("#form-member-add").serializeJSON();
				//给表单对应的bean类属性赋值
				var $itemCode = $("#itemCode").val();
				var itemCode = {
					"itemCode": $itemCode
				};
				$dataFrom.itemCode = itemCode;
				//-----------------------------------------------------------------------
				var $user = $("select:eq(0) option:selected").val();
				var userId = {
					"userId": $user
				};
				$dataFrom.user = userId;
				$dataFrom.id = $urlMsg
				//json转字符串类型
				var dataJSON = JSON.stringify($dataFrom);
				//得到旧编号
				var $oldCode = $("#oldCode").val();
				$.ajax({
					url: HOST_URL + "item/update/" + $oldCode,
					type: "PUT",
					data: dataJSON,
					dataType: "json",
					contentType: "application/json;charset=utf-8",
					success: function(data) {
						if (data == "1") {
							layer.alert("修改成功");
						}
						if (data == "-1") {
							layer.alert('您输入的事项名称/事项编号有重复');
						}
						if (data == "0") {
							layer.alert("修改失败");
						}
						// 关闭窗口
						var index = parent.layer.getFrameIndex(window.name); // 获取窗口索引
						parent.layer.close(index); // 关闭layer
						// 刷新父窗口
						window.parent.location.reload();
					},
					xhrFields: {
						withCredentials: true
					}
				});
			});

		});
	</script>

	<script type="text/javascript">
		leaderInit();
		/**
		 * 初始化批示领导
		 */
		function leaderInit() {
			$.ajax({
				url: HOST_URL + 'showLeader',
				type: 'GET',
				contentType: '',
				success: function(data) {
					var leader = '';
					if (!(data == 'no_leader')) {
						$.each(data, function(i, user) {
							leader += '<option value=' + user.userId + '>' + user.duty.dutyName + '</option>';
						});
						$('#userId').append(leader);
					}
					else {
						leader = '暂无领导';
						$('#userId').append(leader);
					}
				},
				error: function(xhr, type, errorThrown) {
					layer.alert('系统出现错误，请联系管理员');
				},
				xhrFields: {
					withCredentials: true
				}
			}, 'JSON');
		}
	</script>
	<!--/请在上方写此页面业务相关的脚本-->
</body>

</html>
